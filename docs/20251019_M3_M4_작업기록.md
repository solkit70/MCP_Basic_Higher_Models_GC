# 2025-10-19 M3 진행 + M4 예고

목표
- WS echo 데모를 원클릭으로 실행하고 결과를 기록
- 다음 세션에서 M4(FastAPI 스켈레톤)로 자연스럽게 이어지도록 준비

수행 내용
- ws_client.py 개선: 메시지 송신/수신 검증, 타임아웃 옵션 추가
- run_echo_demo.ps1 추가: 로컬 echo 서버 기동 → 클라이언트로 echo 확인 → 로그 저장

실행 방법(PS 5.1)
- `03-discover-servers/scripts/run_echo_demo.ps1`
  - logs/echo_server_*.txt, echo_client_*.txt 생성

기대 결과
- client 로그에 [OK] Connected, [SEND] <msg>, [RECV] <msg>, [OK] Echo matched가 표시

다음 세션 예고(M4)
- `04-app-integration/simple-webapp` 스캐폴딩(FastAPI)
- `/health` 엔드포인트, 설정 로딩, 구조화 로깅
- 이후 M5에서 MCP 클라이언트 연동

---

## M4 시작 전 준비 체크리스트 (요약)
- Python venv 활성화 가능 여부 확인(.venv)
- 포트 사용 가능 여부 확인(기본 8000)
- Windows PowerShell 5.1에서 uvicorn 실행 가능하도록 의존성 설치 계획 수립

## M4 상세 학습 계획 (Step by Step)
1) 의존성 확정 및 설치 스크립트 준비 (10분)
  - 패키지: fastapi, uvicorn[standard], pydantic, python-dotenv, httpx(추후 헬스체크/연동 테스트용)
  - 방법: `02-env-setup/requirements.txt`에 반영 후 `pip install -r`로 일괄 설치 또는 전용 `scripts/install_webapp.ps1` 제공
  - 산출물: 설치 로그(요약), 실패 시 트러블슈팅 메모(방화벽/SSL/프록시 등)

2) 프로젝트 스캐폴딩 생성 (20분)
  - 경로: `04-app-integration/simple-webapp/`
  - 구조:
    - `app/main.py` (FastAPI 앱 팩토리/라우팅 등록)
    - `app/routers/health.py` (`/health` 200, 버전/시간 반환)
    - `app/services/__init__.py` (추후 MCP 클라이언트 래퍼 위치 안내)
    - `config/.env.example` (`APP_ENV`, `PORT`, `LOG_LEVEL` 등)
    - `scripts/run_web.ps1` (uvicorn 실행)
    - `README.md` (실행/테스트/트러블슈팅)
  - 산출물: 초기 파일 세트, 코드 주석으로 학습 포인트 명시

3) 설정 로딩과 구조화 로깅 (15분)
  - `python-dotenv`로 `.env` 로딩, 기본값과 타입 검증(pydantic BaseSettings 또는 수동 검증)
  - 로깅: uvicorn 로거 레벨, 요청/응답 로깅 최소화(PII 주의), JSON 포맷 예시는 선택
  - 산출물: `.env.example`, 설정 모듈/주석, 로그 샘플

4) /health 엔드포인트 구현 및 자체 테스트 (15분)
  - 응답 스키마: `{ "status": "ok", "version": "0.1.0", "time": ISO8601 }`
  - 자체 테스트: `httpx`로 로컬 호출 스크립트 또는 간단한 pytest 테스트(선택)
  - 산출물: 엔드포인트 코드, 수동/자동 테스트 로그

5) 실행 스크립트와 원클릭 실행 흐름 정리 (10분)
  - `scripts/run_web.ps1`: venv 활성화 → uvicorn app.main:app --reload --port $PORT
  - 포트 충돌 시 자동 대체 또는 오류 메시지 개선
  - 산출물: 실행 성공 스크린샷/로그 경로, README에 복붙 가능한 명령

6) 문서화 및 학습 포인트 정리 (10분)
  - README에 구조/레이어(routers/services/config) 설명, 추후 M5 연동 지점 표시
  - 트러블슈팅: 포트/방화벽, 인코딩, PowerShell 실행 정책, .env 로딩 실패 등
  - 산출물: README 갱신, 본 작업기록에 요약 추가

7) 다음 단계 예고(M5와의 연결) (5분)
  - 서비스 계층에 `mcp_client.py` 추가 예정(타임아웃/재시도/스키마 검증 포함)
  - `.env`에 `MCP_SERVER_URI` / `MCP_EXEC_PATH` 등 설정 확장
  - `/mcp/actions/<tool>` 라우트 초안 및 계약 테스트 계획 수립

## 완료 기준(DoD)
- uvicorn으로 로컬 실행 성공(`/health` 200)
- `.env`로 포트/로그 레벨 등 설정 주입 가능, 기본값 정상 동작
- README에 실행/테스트/트러블슈팅이 명확히 정리됨
- 이후 M5에서 바로 MCP 통합을 시작할 수 있을 정도로 구조가 준비됨

## 트러블슈팅 체크리스트
- 모듈 미설치: 가상환경 활성화 후 `pip list`로 확인, 필요시 재설치
- 포트 충돌: 8000 사용 중이라면 8001 등으로 변경(`.env` 또는 run 스크립트 인자)
- Windows 경로/인코딩: UTF-8 저장, 콘솔 글꼴/코드페이지 영향 주의
- ExecutionPolicy: 프로세스 범위 우회(Set-ExecutionPolicy …)로 스크립트 실행 보장
